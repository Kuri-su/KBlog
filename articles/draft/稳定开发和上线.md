# 如何稳定开发和发布的思考与总结
> 如何在周末睡个好觉 以及 避免每天早上的`surprise motherfxxker!` 的 方法论 XD
>
> 笔者当下的一点浅薄的见解，这篇文章阐述的观点在未来或许还会有所发展
[TOC]
## 关于这篇文章的意义
这篇文章尝试在 假设 资源 完全充足的情况下，如何做到 0 错误的发布和开发， 虽然 在实际的开发过程中， 不一定可以全部做到， 但是我们会有 标准去衡量 当前的状态 以及 改进和发展的 方向。
## 事因
发布的程序中有 bug 从而影响功能，是每个开发者都会经历的 事情，笔者从毕业开始到现在常常受其困扰，甚至有时候会恐惧发布 XD。对于这种情况，笔者通常下意识的会将原因归结到 `时间不够` 上面 （当然有的时候确实是笔者 `懒得测试` ……觉得这么简单的功能不会有问题的啦～之类的……）
那么我们接着反问自己一个问题， 假设在所有资源都充足的情况下， 如何完成 `零出错发布` ？
## 观点
这里直接先开门见山给出笔者的 观点： `及时感知和回滚` 和 `减少错误发生的概率`。
从 概率 和 概率 上讲，是人都会犯错，开发者是人，所以 开发者 会犯错。那么既然犯错无法避免，那么我们要避免 用户 比 开发者 先察觉到问题，在那之前 修复 或者 回滚。
仅仅 只做到 快速感知和回滚 是不够的， 另一方面也需要降低发布后出问题的概率，这就需要做好 开发 和 发布的流程。
另外，低错误率 会一定程度上延长项目工期，但这是值得的。
## How？
笔者认为 可以分为以下三个 阶段来阐述 ,`设计阶段`，`编码阶段`，`发布阶段`
* 设计阶段
	* 避免引入 不够稳定  和 过于复杂 以及 不成熟的特性
* 编码阶段
	* 克制修改的诱惑
	* 做好灰度发布的准备
		* 灰度开关
		* 重要位置的错误告警
	* 测试
		* 集成测试
		* 单元测试 
* 发布阶段
	* 发布策略
		* 灰度/金丝雀/蓝绿 发布
	* 持续关注错误率 和 日志 与快速回滚切换
### 设计阶段
#### 避免引入 不够稳定  和 过于复杂 以及 不成熟的特性
开发的乐趣在于 实现功能，或者更近一步说 在于细节。我们想要用更 power  或者 更加 fushion 的形式去实现一个细节，在当前的项目里去实践那些知名项目中的具体实现。这种过程可能是 不够稳定的， 或者 过于复杂的 以及极易 引入 一些不成熟的特性。 
而在项目层面， 则需要保障稳定，需要的时完成的结果，以及 可维护性和写协作。任何 过度复杂 和 不成熟的特性， 都很容易和上面要关注的点相冲突。 所以有一个方法论就是 保持项目的简单，才更容易保持 项目的 稳定以及可维护。
那么从这样看来， 上述二者似乎处于一种互相制衡的关系上。一方面我们你需要抵制诱惑，避免引入 不稳定的特性。另一方面，我们也需要不断求知，以提高项目的水平和 以更高的 视野来简化项目的实现。
如何让二者在 某种程度 或者 维度上 达成均衡，是需要持续考虑的问题。
把稳定、合适、且能解决实际问题的元素 引入项目，而克制 将 感兴趣 却解决不了问题的点 带入项目 而 影响项目的 形状 和 稳定。 
#### 便于测试的结构
在设计的时候，结构上就需要为测试的便利性作出考虑，例如将外部依赖的逻辑做成 单独的 util 或者 pkg，以便 mock 和测试。
不过在这一块，笔者目前实践的还比较少。 
### 编码阶段
#### 克制修改的诱惑
往往在开发新功能的时候，我们很想去做以下的事情，
* 修改之前写的觉得 结构不够优雅的代码段，即便它只是看上去舒服了😌
* 升级部分依赖，即便什么新特性都没有，新版本也只是修了几个无关痛痒的 bug，但是看到它是新版本就莫名舒服😌
* ... 
`「顺便」` 对吧～but HOLD ON！这其实很容易给项目带来意料之外的不确定性。这种不是计划中的修改又不会专门
#### 做好灰度发布的准备
这个主要是针对
### 发布阶段
## So，What's Next？
所以做到了以上这些，就能够保证 稳定发布了么？
笔者觉得 做到稳定发布这件事情是 Endless 的，需要根据当下环境 做出 合适的 行动。
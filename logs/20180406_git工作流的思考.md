# Git 工作流的思考

因为公司在多人协作上的混乱，所以准备向更加规范化的Git workFlow 迁移。但大部分的资料都是在描述git上的分支的工作流，而具体的实践却很少提到，所以记录下自己对git工作流的思考。

## 0x00

Git 工作流应该分成三个部分:

* 本地部分
* 提交到版本库
* 上线流程

### 基本分支配置

* **master**  // 上线分支，打好Tag上线，文件与线上基本一致
* **dev**     // 开发分支，算是内网的正式分支
* **test**    // 测试分支，在本地测试完成后
* **other_one/feature_branch**
* ……

### 本地部分

* 在每次需要开发新的功能或者修复bug的时候从dev分支拉出新的一条分支。

* 在某个功能提交的时候，需要本地优先测试。**在这里会引申出一些问题，下面分类讨论**
    * 每种语言都有相应的自动化测试框架，例如PHP的PHPUnit等，使用自动化测试进行测试。如果是功能性的Bug，使用PHPUnit，在覆盖率足够的情况下基本都应该可以察觉到。
    * 因为目前所在的公司使用的是内外网的开发模式，那么如果有些需要外网才能测试的代码，我们需要使用一些公用的桩测试代码，来模拟测试。
    * 对于样式上的测试，可能还是需要点击。
    * …… `待补充`

* 提交信息遵照 [git-commit-message-guide]() 作为标准，允许临时的提交使用类似于`tmp commit`,`update`作为提交信息，但是在最后合并到test或者dev分支的时候，尽量使用rebase操作合并到别的提交，或者后期补上。
    * 尽量使每一次提交都有意义。

* 在本地开发完一个功能测试无误后再进行提交。如果是某些功能突然要求先上的话，可以从当前的分支中将相应的功能抽离出来，作为一个新的分支，然后合并到dev或者test分支。

* 尽量不要对已经提交到中央版本库的提交进行变基，这样在多人协作的情况下可能会出现不可预知的问题！

### 提交到版本库

在本地测试机上有两个测试部署

* dev
    * 对应 DEV 分支，作用是给测试提供可正常测试的环境，并且可以随时上线。
* test
    * 是开发还没有确定可以提交的位置。

### 上线流程

* 将dev合并到master，打上tag，将master打包上线到Alpha测试环境
* 一旦上线出现问题,可以选择回滚到上一个版本
* (undone) 版本号的命名规则
* 在使用 git-commit-message-guide 时，生成更新日志可以使用git commit log 生成日志作为参考。

